<Window x:Class="MediaMetadataEditor.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:core="clr-namespace:MediaMetadataEditor.Core"
        xmlns:helpers="clr-namespace:MediaMetadataEditor.Helpers"
        Title="Media Metadata Editor" Height="760" Width="1200"
        WindowStartupLocation="CenterScreen" Background="{DynamicResource BgBrush}">
    <Grid>
        <DockPanel Margin="12">
            <ToolBarTray DockPanel.Dock="Top" Background="{DynamicResource PanelBrush}">
                <ToolBar>
                    <Button Content="Adicionar arquivos" Command="{Binding VM.CmdAddFiles}" Margin="4"/>
                    <Button Content="Remover selecionados" Command="{Binding VM.CmdRemoveSelected}" Margin="4"/>
                    <Button Content="Limpar" Command="{Binding VM.CmdClear}" Margin="4"/>
                    <Button Content="Remover duplicados" Command="{Binding VM.CmdDedupe}" Margin="4"/>
                    <Separator/>
                    <Button Content="Aplicar" Command="{Binding VM.CmdApply}" Margin="4"/>
                    <Button Content="Pré-visualizar" Command="{Binding VM.CmdPreviewSelected}" Margin="4"/>
                    <Separator/>
                    <Button Content="Abrir logs" Command="{Binding VM.CmdOpenLogs}" Margin="4"/>
                </ToolBar>
                <ToolBar HorizontalAlignment="Right">
                    <TextBlock Text="{Binding VM.StatusText}" VerticalAlignment="Center" Foreground="{DynamicResource TextSecondaryBrush}" Margin="8,0"/>
                </ToolBar>
            </ToolBarTray>

            <Grid Margin="0,10,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2.2*" />
                    <ColumnDefinition Width="3*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="{DynamicResource PanelBrush}" CornerRadius="8" Padding="8">
                    <DockPanel>
                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
                            <CheckBox Content="Mostrar campos ocultos" IsChecked="{Binding VM.ShowHiddenFields}" Command="{Binding VM.CmdToggleShowHidden}" Margin="4"/>
                            <TextBlock Text="{Binding VM.Files.Count, StringFormat=Arquivos: {0}}" VerticalAlignment="Center" Margin="8,0"/>
                        </StackPanel>

                        <ListBox x:Name="FilesList" ItemsSource="{Binding VM.Files}" DisplayMemberPath="FileName"
                                 helpers:SelectedItemsBehavior.SelectedItems="{Binding VM.SelectedFiles}" SelectionMode="Extended"
                                 Margin="0,8,0,0" />

                    </DockPanel>
                </Border>

                <Border Grid.Column="1" Background="{DynamicResource PanelBrush}" CornerRadius="8" Padding="12" Margin="12,0,0,0">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <ItemsControl ItemsSource="{Binding VM.FieldViewModels}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <DockPanel Margin="0,6" RenderTransformOrigin="0.5,0.5">
                                            <DockPanel.RenderTransform>
                                                <TranslateTransform X="0" Y="0"/>
                                            </DockPanel.RenderTransform>
                                            <CheckBox IsChecked="{Binding IsChecked}" IsEnabled="{Binding IsEnabled}" VerticalAlignment="Center" Width="28" />
                                            <Label Content="{Binding DisplayName}" Width="160" Margin="6,0"/>
                                            <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}" Width="420" Margin="6,0"/>
                                        </DockPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                <Button Content="Remover substring..." Command="{Binding VM.CmdRemoveSubstring}" Width="160" Margin="0,0,8,0"/>
                                <Button Content="Salvar preset" Command="{Binding VM.CmdSavePreset}" Width="140" Margin="0,0,8,0"/>
                                <Button Content="Deletar preset" Command="{Binding VM.CmdDeletePreset}" Width="140" Margin="0,0,8,0"/>
                                <Button Content="Abrir capability" Command="{Binding VM.CmdOpenCapability}" Width="160"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>

            <StatusBar DockPanel.Dock="Bottom" Height="26" Background="{DynamicResource PanelBrush}">
                <StatusBarItem><TextBlock Text="{Binding VM.StatusText}" /></StatusBarItem>
                <StatusBarItem HorizontalAlignment="Right"><TextBlock Text="Media Metadata Editor — v1.0" /></StatusBarItem>
            </StatusBar>
        </DockPanel>

        <Grid x:Name="IntroOverlay" Background="#CC000000" Visibility="Visible">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5">
                <StackPanel.RenderTransform>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </StackPanel.RenderTransform>
                <TextBlock Text="Media Metadata Editor" FontSize="36" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                <TextBlock Text="Carregando interface..." FontSize="16" Foreground="White" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
